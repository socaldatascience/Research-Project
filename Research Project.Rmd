---
title: "Child Patients with Covid-19 and Cystic Fibrosis"
author: "Alfonso Vieyra"
date: '2022-06-30'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```
```{r}
library(tidyverse)
library(ggplot2)
library(scales)
```

## Part 1


```{r}
library(viridis)
library(hrbrthemes)

#sub data frame of patients with CF
cf <- filter(d, has_cf == 1)

#contingency table of observed counts between CF and non-CF of lvls of sympt.
con_tab <- d %>% 
  select(has_cf, COVIDseverity)
table(con_tab)

#graph of contingency NOTE: graph is zoom in to show cf patient bars
ggplot(con_tab) +
  geom_bar(mapping = aes(x=has_cf, fill = COVIDseverity), 
           position = 'dodge') +
  coord_cartesian(ylim = c(0, 60000))

```

```{r wrap}
#using face_wrap for con_tab
ggplot(con_tab, aes(fill=COVIDseverity, x=has_cf)) + 
    geom_bar(position="dodge") +
    scale_fill_viridis(discrete = T, option = "E") +
    ggtitle("Observed counts") +
    facet_wrap(~has_cf) +
    theme_ipsum() +
    theme(legend.position="none") +
    xlab("") + 
  coord_cartesian(ylim = c(0, 60000))
```

```{r grid}
#using facet_grid for con_table
ggplot(con_tab) +
  geom_bar(mapping = aes(x=has_cf, fill = COVIDseverity), position = 'dodge') +
  facet_grid(has_cf~.) + 
  coord_cartesian(ylim = c(0, 60000))
```

```{r morbidities}
#table with severity, cf and comorbidities
con_tab2 <- d %>%
  select(has_cf, COVIDseverity, starts_with('comorb')) %>%
  filter(has_cf == 0)

#retrieve most prevalent diseases
summary(con_tab2)
```

```{r sever0}
severity0 <- con_tab2 %>%
  filter(COVIDseverity == 0)

summary(severity0)
```

```{r sever1}
severity1 <- con_tab2 %>%
  filter(COVIDseverity == 1)

summary(severity1)
```

```{r sever2}
severity2 <- con_tab2 %>%
  filter(COVIDseverity == 2)

summary(severity2)
```


## Part 2

## Part 3

## Part 4

## Part 5
```{r}
non_cf <- d %>%
  filter(has_cf == 0)
```
```{r}
non_cf %>% 
  ggplot(aes(x=COVIDseverity)) +
  geom_bar(fill = "magenta")
```
```{r}
  d %>% 
  select(has_cf, COVIDseverity) %>% 
  table()
```
```{r}
non_cf %>% 
  select(age_at_encounter, ethnicity) %>% 
  table()
```
```{r}
non_cf %>%
 group_by(COVIDseverity) %>%
 count()
```
```{r}
non_cf %>% 
  select(COVIDseverity, ethnicity) %>% 
  table()
```
```{r}
non_cf %>% 
  select(COVIDseverity, zip_code) %>% 
  table()
```
```{r}
non_cf %>% 
  select(COVIDseverity, race) %>% 
  table()
```
```{r}
non_cf %>% 
  select(COVIDseverity, encountertype) %>% 
  table()
```
```{r}
non_cf %>% 
  ggplot(aes(x=COVIDseverity,
             y=age_at_encounter, fill = COVIDseverity)) +
  geom_boxplot() +
  labs(x = "COVID Severity", 
       y = "Age at Encounter", 
       title = "COVID Severity among children without Cystic Fibrosis") +
  scale_fill_manual(values =c("#E69F00","#009E73","#56B4E9"))
```
```{r}
non_cf %>% 
  ggplot(aes(x=COVIDseverity, fill = race)) +
  geom_bar()
```
```{r}
d %>% 
  ggplot(aes(x=COVIDseverity,
             y=age_at_encounter, 
             fill = has_cf)) +
  geom_boxplot() +
  labs(x = "COVID Severity", y = "Age at Encounter") +
  ggtitle("COVID Severity Among Children based on Age") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_fill_manual(values =c("#E69F00","#009E73"), 
                    labels = c("Non CF","CF"), 
                    name = "Cystic Fibrosis Diagnosis") 
```
```{r}
non_cf %>% 
  ggplot(aes(x=race, fill = COVIDseverity)) +
  geom_bar(position = "dodge") + 
  coord_flip() +
  labs(x = "Race", y = "Count") +
  ggtitle("COVID Severity Among Children based on Race") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_fill_manual(values =c("#E69F00","#009E73","#56B4E9"), 
                    labels = c("Asymptomatic","Moderate","Severe"),
                    name = "COVID Severity") +
  scale_y_continuous(labels = comma)
```
```{r}
non_cf %>% 
  ggplot(aes(x=ethnicity, fill = COVIDseverity)) +
  geom_bar(position = "dodge") +
  labs(x = "Ethnicity", y = "Count") +
  ggtitle("COVID Severity Among Children based on Ethnicity") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_fill_manual(values =c("#E69F00","#009E73","#56B4E9"), 
                    labels = c("Asymptomatic","Moderate","Severe"),
                    name = "COVID Severity") +
  scale_y_continuous(labels = comma)
```
```{r}
d %>% 
  ggplot(aes(x=encountertype, 
             fill = has_cf)) +
  geom_bar(position = "dodge") +
  labs(x = "COVID Severity", y = "Age at Encounter") +
  ggtitle("COVID Severity Among Children based on Age") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_fill_manual(values =c("#E69F00","#009E73"), 
                    labels = c("Non CF","CF"), 
                    name = "Cystic Fibrosis Diagnosis") +
  coord_flip()
```




